<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Sticker Tagger App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        const wsPath = "{{ .WSPath }}";
        let webApp = Telegram.WebApp;
        async function foo() {
            console.log("foo called");
            fetch("/hash", {
                method: "POST",
                body: webApp.initData
            }).then(async res => {
                if (!res.ok) {
                    console.error(await res.text());
                    return;
                }
                let resp = await res.json();
                console.log(resp);

                let socket = new WebSocket(wsPath);
                socket.onopen = () => {
                    console.log("socket opened");
                    const secret = "secret_data";
                    socket.send(secret);
                    console.log("TO SERVER: \"" + secret + "\"");
                };
                socket.onerror = (ev) => console.error(ev);
                socket.onmessage = (ev) => console.log("FROM SERVER: \"" + ev.data + "\"");
                socket.onclose = () => console.log("socket closed");
            });
        }

        window.onload = foo;
    </script>
</head>

<body>
    <h1>Hello everynyan</h1>
</body>
</html>
